<!DOCTYPE html>
<html lang="en" dir="ltr" class="light"> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plasticology Ultimate Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="flex items-center justify-center min-h-screen p-2 sm:p-4">

    <canvas id="login-canvas"></canvas>

    <div id="settings-container">
        <button id="toggle-animation-btn" title="Toggle Animation">
            <i class="fas fa-play-circle animation-on-icon"></i>
            <i class="fas fa-pause-circle animation-off-icon" style="display: none;"></i>
        </button>
        <button id="dark-mode-toggle" title="Toggle Dark Mode">
            <i class="fas fa-moon"></i>
            <i class="fas fa-sun" style="display: none;"></i>
        </button>
    </div>

    <div id="app-container" class="hidden w-full max-w-7xl mx-auto">
        
        <div id="watermark-overlay" class="watermark hidden"></div>

        <header id="global-header" class="flex justify-between items-center p-4 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm rounded-t-xl shadow-md border-b border-slate-200 dark:border-slate-700 hidden">
            <div class="flex items-center gap-4">
                <button id="global-home-btn" class="header-btn" title="Main Menu"><i class="fas fa-home"></i></button>
                <div class="relative">
                    <button id="user-profile-header-btn" class="flex items-center gap-2">
                        <img id="header-user-avatar" src="" alt="Avatar" class="w-8 h-8 rounded-full">
                        <span id="user-name-display" class="font-bold text-slate-700 dark:text-slate-200"></span>
                    </button>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button id="announcements-btn" class="header-btn" title="Announcements"><i class="fas fa-bell"></i></button>
                <button id="notes-btn" class="header-btn" title="My Notes"><i class="fas fa-sticky-note"></i></button>
                <button id="activity-log-btn" class="header-btn" title="Activity Log"><i class="fas fa-history"></i></button>
                <button id="logout-btn" class="header-btn" title="Logout"><i class="fas fa-sign-out-alt"></i></button>
            </div>
        </header>

        <main id="main-content" class="bg-white/95 dark:bg-slate-800/95 rounded-b-xl shadow-lg">
            
            <div id="login-container" class="flex items-center justify-center p-8">
                <div class="w-full max-w-md bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm p-8 rounded-xl shadow-2xl border border-white/40 dark:border-slate-700/40 text-center">
                    <h1 class="text-4xl font-bold mb-2 text-slate-800 dark:text-slate-100">Plasticology</h1>
                    <p class="text-slate-500 dark:text-slate-400 mb-8">Ultimate QBank Edition</p>
                    <form id="login-form">
                        <div class="mb-4">
                            <input type="text" id="username-input" class="form-input" placeholder="Username" required>
                        </div>
                        <div class="mb-6">
                            <input type="password" id="password-input" class="form-input" placeholder="Password" required>
                        </div>
                        <p id="login-error" class="text-red-500 text-sm mb-4 hidden"></p>
                        <button id="login-submit-btn" type="submit" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition-colors">Login</button>
                    </form>
                    <p class="text-sm text-slate-500 dark:text-slate-400 mt-6">
                        Don't have an account? 
                        <a href="#" id="show-register-link" class="font-semibold text-blue-600 hover:text-blue-700">Register Now</a>
                    </p>
                </div>
            </div>
            
            <div id="main-menu-container" class="main-app-container hidden">
                <div id="last-activity-ribbons">
                     <div id="last-lecture-ribbon" class="ribbon bg-blue-100 text-blue-800 hidden"></div>
                     <div id="last-quiz-ribbon" class="ribbon bg-green-100 text-green-800 hidden"></div>
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-6">
                    <button id="lectures-btn" class="main-menu-btn bg-blue-600 hover:bg-blue-700">
                        <i class="fas fa-video"></i><span>Lectures</span>
                    </button>
                    <button id="qbank-btn" class="main-menu-btn bg-green-600 hover:bg-green-700">
                        <i class="fas fa-question-circle"></i><span>MCQ Bank</span>
                    </button>
                    <button id="learning-mode-btn" class="main-menu-btn bg-indigo-600 hover:bg-indigo-700">
                        <i class="fas fa-chalkboard-teacher"></i><span>Learning Mode</span>
                    </button>
                     <button id="osce-btn" class="main-menu-btn bg-rose-600 hover:bg-rose-700">
                        <i class="fas fa-user-md"></i><span>OSCE Bank</span>
                    </button>
                     <button id="leaderboard-btn" class="main-menu-btn bg-yellow-500 hover:bg-yellow-600">
                        <i class="fas fa-trophy"></i><span>Leaderboard</span>
                    </button>
                    <button id="radio-btn" class="main-menu-btn bg-pink-500 hover:bg-pink-600">
                        <i class="fas fa-broadcast-tower"></i><span>Radio</span>
                    </button>
                    <button id="library-btn" class="main-menu-btn bg-teal-600 hover:bg-teal-700">
                        <i class="fas fa-book"></i><span>Library</span>
                    </button>
                    <button id="planner-btn" class="main-menu-btn bg-sky-600 hover:bg-sky-700">
                        <i class="fas fa-calendar-alt"></i><span>Study Planner</span>
                    </button>
                    <button id="theory-mode-btn" class="main-menu-btn bg-purple-600 hover:bg-purple-700">
                        <i class="fas fa-book-open"></i><span>Theory Bank</span>
                    </button>
                    <button id="matching-mode-btn" class="main-menu-btn bg-amber-600 hover:bg-amber-700">
                        <i class="fas fa-puzzle-piece"></i><span>Matching Bank</span>
                    </button>
                </div>
            </div>

            <div id="lectures-container" class="main-app-container hidden">
                <h1 class="main-title">Lectures</h1>
                <div class="mb-4">
                     <input type="text" id="lecture-search-input" class="form-input w-full" placeholder="Search for a lecture or chapter...">
                </div>
                <div id="lectures-list" class="space-y-2"></div>
            </div>

            <div id="qbank-container" class="main-app-container hidden">
                <h1 class="main-title">MCQ Bank</h1>
                 <div class="text-center mb-4 text-sm text-slate-500">
                    <label class="mr-4"><input type="radio" name="qbank-scope" id="scope-all" value="all" checked class="mr-1"> All Questions</label>
                    <label><input type="radio" name="qbank-scope" id="scope-unanswered" value="unanswered" class="mr-1"> Unanswered Only</label>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="card p-6 text-center">
                        <i class="fas fa-random text-4xl text-blue-500 mb-4"></i>
                        <h2 class="font-bold text-xl mb-2 text-slate-800">Custom Mock Exam</h2>
                        <p class="text-slate-500 mb-4">Build your own quiz. Select chapters, sources, and number of questions.</p>
                        <button id="mock-exam-btn" class="action-btn bg-blue-600 hover:bg-blue-700 text-white w-full">Create Mock</button>
                    </div>
                    <div class="card p-6 text-center">
                        <i class="fas fa-stopwatch text-4xl text-green-500 mb-4"></i>
                        <h2 class="font-bold text-xl mb-2 text-slate-800">Simulation Exam</h2>
                        <p class="text-slate-500 mb-4">Test your knowledge with a timed exam of 100 random questions.</p>
                        <button id="simulation-exam-btn" class="action-btn bg-green-600 hover:bg-green-700 text-white w-full">Start Simulation</button>
                    </div>
                    <div class="card p-6 text-center">
                        <i class="fas fa-book-open text-4xl text-indigo-500 mb-4"></i>
                        <h2 class="font-bold text-xl mb-2 text-slate-800">Browse Questions</h2>
                        <p class="text-slate-500 mb-4">Explore questions by chapter or by source for focused study.</p>
                         <div class="flex gap-2">
                             <button id="browse-chapter-btn" class="action-btn bg-indigo-600 hover:bg-indigo-700 text-white w-full">By Chapter</button>
                             <button id="browse-source-btn" class="action-btn bg-indigo-600 hover:bg-indigo-700 text-white w-full">By Source</button>
                         </div>
                    </div>
                </div>
                <div class="mt-8 p-6 card">
                     <h2 class="font-bold text-xl mb-4 text-slate-800 text-center">Quick Start</h2>
                     <div class="input-with-icon-container mb-4">
                         <i class="fas fa-search input-icon"></i>
                         <input type="text" id="qbank-search-input" class="form-input w-full pl-10" placeholder="Search for a specific topic (e.g., 'flap', 'nerve')...">
                     </div>
                     <div id="qbank-search-results" class="text-center"></div>
                </div>
            </div>
            
            <div id="list-container" class="main-app-container hidden">
                <h1 id="list-title" class="main-title"></h1>
                <div id="list-items" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
            </div>

            <div id="quiz-container" class="main-app-container hidden">
                 <div id="quiz-header" class="flex justify-between items-center mb-4">
                    <h2 id="quiz-title" class="text-xl font-bold text-slate-800">Quiz</h2>
                    <div class="flex items-center gap-4">
                        <div id="quiz-timer" class="font-bold text-lg"><i class="far fa-clock mr-2"></i><span>00:00</span></div>
                        <div class="font-bold text-lg"><i class="far fa-star mr-2"></i><span id="quiz-score">0</span></div>
                    </div>
                </div>
                <div id="progress-bar-container" class="w-full bg-slate-200 rounded-full h-2.5 mb-4">
                    <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
                 <p id="progress-text" class="text-center text-slate-500 mb-4">Question 1 of 10</p>
                <div id="question-card" class="card p-6">
                    <p id="question-text" class="text-lg font-semibold mb-4 text-slate-800"></p>
                    <div id="question-image-container" class="my-4 hidden"></div>
                    <div id="answer-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                </div>
                <div id="quiz-navigation" class="flex justify-between mt-6">
                    <button id="prev-question-btn" class="nav-btn"><i class="fas fa-arrow-left mr-2"></i> Previous</button>
                    <div class="flex items-center gap-2">
                         <button id="hint-btn" class="nav-btn bg-yellow-500 hover:bg-yellow-600 text-white" title="Show Hint"><i class="fas fa-lightbulb"></i></button>
                         <button id="flag-btn" class="nav-btn bg-orange-500 hover:bg-orange-600 text-white" title="Flag for Review"><i class="far fa-flag"></i></button>
                         <button id="bookmark-btn" class="nav-btn bg-teal-500 hover:bg-teal-600 text-white" title="Bookmark Question"><i class="far fa-bookmark"></i></button>
                         <button id="note-taking-btn" class="nav-btn bg-indigo-500 hover:bg-indigo-600 text-white" title="Add a Note"><i class="fas fa-edit"></i></button>
                         <button id="navigator-btn" class="nav-btn" title="Question Navigator"><i class="fas fa-th-large"></i></button>
                    </div>
                    <button id="next-question-btn" class="nav-btn">Next <i class="fas fa-arrow-right ml-2"></i></button>
                </div>
                <div id="rationale-container" class="mt-6 p-4 bg-slate-50 rounded-lg hidden">
                    <h3 class="font-bold text-lg mb-2">Rationale</h3>
                    <p id="rationale-text"></p>
                </div>
                <div id="quiz-results-container" class="text-center p-8 hidden">
                    <h2 class="text-3xl font-bold mb-4">Quiz Complete!</h2>
                    <p class="text-xl mb-2">Your Score: <span id="final-score" class="font-bold"></span></p>
                    <p id="final-percentage" class="text-lg text-slate-500 mb-6"></p>
                    <div class="flex justify-center gap-4">
                        <button id="restart-quiz-btn" class="action-btn bg-blue-600 hover:bg-blue-700">Restart Quiz</button>
                        <button id="review-mistakes-btn" class="action-btn bg-red-600 hover:bg-red-700">Review Mistakes</button>
                        <button id="back-to-menu-btn" class="action-btn bg-slate-500 hover:bg-slate-600">Main Menu</button>
                    </div>
                </div>
            </div>

            <div id="activity-log-container" class="main-app-container hidden">
                <h1 class="main-title">Activity Log</h1>
                <div class="flex justify-center mb-6 border-b pb-4">
                    <button id="log-filter-all" class="filter-btn active" onclick="window.app.renderFilteredLog('all')">All</button>
                    <button id="log-filter-quizzes" class="filter-btn" onclick="window.app.renderFilteredLog('quizzes')">Quizzes</button>
                    <button id="log-filter-lectures" class="filter-btn" onclick="window.app.renderFilteredLog('lectures')">Lectures</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                     <div id="all-summary" class="summary-card"></div>
                     <div id="quiz-summary" class="summary-card"></div>
                     <div id="lecture-summary" class="summary-card"></div>
                </div>
                <canvas id="activity-chart" class="mb-6"></canvas>
                <div class="flex justify-end mb-4">
                     <button id="clear-log-btn" class="text-sm text-red-500 hover:text-red-700"><i class="fas fa-trash-alt mr-1"></i> Clear Activity Log</button>
                </div>
                <ul id="activity-log-list" class="space-y-3"></ul>
            </div>
            
            <div id="notes-container" class="main-app-container hidden">
                <h1 class="main-title">My Notes</h1>
                <div class="flex justify-center mb-6 border-b pb-4">
                     <button id="notes-filter-quizzes" class="filter-btn active" onclick="window.app.renderNotes('quizzes')">Quiz Notes</button>
                     <button id="notes-filter-lectures" class="filter-btn" onclick="window.app.renderNotes('lectures')">Lecture Notes</button>
                     <button id="notes-filter-theory" class="filter-btn" onclick="window.app.renderNotes('theory')">Theory Notes</button>
                </div>
                <ul id="notes-list" class="space-y-4"></ul>
            </div>
            
            <div id="library-container" class="main-app-container hidden">
                <h1 class="main-title">Library</h1>
                <div id="library-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
            </div>

             <div id="leaderboard-container" class="main-app-container hidden">
                <h1 class="main-title">Leaderboard</h1>
                <div id="leaderboard-loader" class="text-center"><div class="loader"></div></div>
                <ol id="leaderboard-list" class="space-y-3"></ol>
                <div id="current-user-rank-div" class="mt-8"></div>
            </div>
            
             <div id="osce-container" class="main-app-container hidden">
                 <h1 class="main-title">OSCE Bank</h1>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                     <div class="card p-6 text-center">
                        <i class="fas fa-bolt text-4xl text-amber-500 mb-4"></i>
                        <h2 class="font-bold text-xl mb-2 text-slate-800">OSCE Slayer</h2>
                        <p class="text-slate-500 mb-4">A comprehensive, random quiz covering all available cases to test your readiness.</p>
                        <button id="osce-slayer-btn" class="action-btn bg-amber-600 hover:bg-amber-700 text-white w-full">Start Slayer Mode</button>
                    </div>
                     <div class="card p-6">
                         <h2 class="font-bold text-xl mb-4 text-slate-800 text-center">Custom OSCE Session</h2>
                         <div class="mb-4">
                            <label for="osce-case-count" class="block text-sm font-bold text-slate-700 mb-2">Number of Cases</label>
                            <input type="number" id="osce-case-count" value="5" min="1" class="shadow appearance-none border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500">
                         </div>
                         <details class="insights-details">
                            <summary class="insights-summary">Customize by Chapter & Source <i class="fas fa-chevron-down"></i></summary>
                            <div class="insights-content mt-4">
                                <h3 class="font-bold text-lg mb-2 text-slate-800">Filter by Chapter</h3>
                                <div id="chapter-select-osce" class="filter-grid"></div>
                                <h3 class="font-bold text-lg mt-6 mb-2 text-slate-800">Filter by Source</h3>
                                <div id="source-select-osce" class="filter-grid"></div>
                            </div>
                        </details>
                         <p id="osce-error" class="text-red-500 text-sm mt-4 hidden"></p>
                         <button id="custom-osce-btn" class="action-btn bg-rose-600 hover:bg-rose-700 text-white w-full mt-4">Start Custom Session</button>
                     </div>
                 </div>
            </div>
            
            <div id="osce-quiz-container" class="main-app-container hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="osce-quiz-title" class="text-xl font-bold text-slate-800">OSCE Session</h2>
                    <div class="flex items-center gap-4">
                        <div id="osce-timer" class="font-bold text-lg"><i class="far fa-clock mr-2"></i><span>00:00</span></div>
                        <div class="font-bold text-lg"><i class="far fa-star mr-2"></i><span id="osce-score">0</span> / <span id="osce-total">0</span></div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div id="osce-case-details" class="card p-4">
                        <h3 id="osce-case-title" class="font-bold text-lg mb-2"></h3>
                        <p id="osce-case-description" class="text-sm text-slate-600 mb-4"></p>
                        <img id="osce-case-image" src="" alt="Case Image" class="rounded-lg shadow-md w-full hidden">
                        <audio id="osce-case-audio" controls class="w-full mt-4 hidden"></audio>
                    </div>
                    <div id="osce-question-area" class="card p-4">
                         <p id="osce-progress-text" class="text-center text-slate-500 mb-4"></p>
                         <p id="osce-question-text" class="font-semibold mb-4"></p>
                         <div id="osce-answer-options" class="space-y-3"></div>
                         <div id="osce-essay-container" class="hidden">
                             <textarea id="osce-essay-answer" class="form-input w-full h-32" placeholder="Type your answer here..."></textarea>
                         </div>
                    </div>
                </div>
                 <div id="osce-navigation" class="flex justify-between mt-6">
                    <button id="osce-prev-btn" class="nav-btn"><i class="fas fa-arrow-left mr-2"></i> Previous</button>
                    <button id="osce-navigator-btn" class="nav-btn"><i class="fas fa-th-large"></i> Navigator</button>
                    <button id="osce-next-btn" class="nav-btn">Next <i class="fas fa-arrow-right ml-2"></i></button>
                </div>
                 <div id="osce-results-container" class="text-center p-8 hidden"></div>
            </div>
            
            <div id="learning-mode-container" class="main-app-container hidden">
                <div id="learning-mode-controls">
                     <h1 class="main-title">Learning Mode</h1>
                     <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="card p-6 text-center">
                            <i class="fas fa-book-reader text-4xl text-blue-500 mb-4"></i>
                            <h2 class="font-bold text-xl mb-2 text-slate-800">Browse All</h2>
                            <p class="text-slate-500 mb-4">Study all questions one by one with immediate rationale and answers.</p>
                            <button id="learning-browse-all-btn" class="action-btn bg-blue-600 hover:bg-blue-700 text-white w-full">Start Browsing</button>
                        </div>
                         <div class="card p-6 text-center">
                            <i class="fas fa-times-circle text-4xl text-red-500 mb-4"></i>
                            <h2 class="font-bold text-xl mb-2 text-slate-800">Study Mistakes</h2>
                            <p class="text-slate-500 mb-4">Focus on questions you've previously answered incorrectly.</p>
                            <button id="learning-study-mistakes-btn" class="action-btn bg-red-600 hover:bg-red-700 text-white w-full">Review Mistakes</button>
                        </div>
                        <div class="card p-6 text-center">
                            <i class="fas fa-bookmark text-4xl text-teal-500 mb-4"></i>
                            <h2 class="font-bold text-xl mb-2 text-slate-800">Bookmarked</h2>
                            <p class="text-slate-500 mb-4">Review all the questions that you have bookmarked for later.</p>
                            <button id="learning-study-bookmarked-btn" class="action-btn bg-teal-600 hover:bg-teal-700 text-white w-full">Review Bookmarks</button>
                        </div>
                    </div>
                     <div class="mt-8 p-6 card">
                         <h2 class="font-bold text-xl mb-4 text-slate-800 text-center">Search for a Topic</h2>
                         <div class="input-with-icon-container mb-4">
                             <i class="fas fa-search input-icon"></i>
                             <input type="text" id="learning-search-input" class="form-input w-full pl-10" placeholder="Search for a specific topic to study...">
                         </div>
                     </div>
                </div>

                <div id="learning-mode-viewer" class="hidden">
                    <h2 id="learning-title" class="main-title"></h2>
                    <p id="learning-progress" class="text-center text-slate-500 mb-4"></p>
                    <div id="learning-card" class="card p-6">
                        <p id="learning-question" class="text-lg font-semibold mb-4 text-slate-800"></p>
                        <div id="learning-image-container" class="my-4 hidden"></div>
                        <button id="learning-show-answer-btn" class="action-btn bg-green-600 hover:bg-green-700 text-white">Show Answer</button>
                        <div id="learning-answer-container" class="mt-4 hidden">
                             <p id="learning-answer" class="font-bold text-lg text-blue-700"></p>
                             <div id="learning-rationale" class="mt-2 p-4 bg-slate-50 rounded-lg"></div>
                        </div>
                    </div>
                    <div class="flex justify-between mt-6">
                        <button id="learning-prev-btn" class="nav-btn"><i class="fas fa-arrow-left mr-2"></i> Previous</button>
                        <button id="learning-next-btn" class="nav-btn">Next <i class="fas fa-arrow-right ml-2"></i></button>
                    </div>
                </div>
            </div>
            
            <div id="study-planner-container" class="main-app-container hidden">
                <div id="study-planner-loader" class="text-center p-8"><div class="loader"></div></div>

                <div id="planner-dashboard" class="hidden">
                    <h1 class="main-title">Study Planner</h1>
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-semibold text-slate-700">Your Plans</h2>
                        <button id="create-new-plan-btn" class="action-btn bg-green-600 hover:bg-green-700 text-white"><i class="fas fa-plus mr-2"></i>Create New Plan</button>
                    </div>
                    <div id="plan-list" class="space-y-4"></div>
                </div>

                <div id="active-plan-view" class="hidden">
                    <div class="flex justify-between items-center mb-4">
                        <div>
                             <h1 id="plan-name" class="main-title"></h1>
                             <p id="plan-date-range" class="text-slate-500 -mt-4 mb-4"></p>
                        </div>
                        <button id="back-to-plans-btn" class="nav-btn"><i class="fas fa-arrow-left mr-2"></i> All Plans</button>
                    </div>
                    
                    <div id="performance-insights-container" class="mb-6 card p-4">
                        <details class="insights-details">
                            <summary class="insights-summary">Performance Insights <i class="fas fa-chevron-down"></i></summary>
                            <div class="insights-content grid grid-cols-1 md:grid-cols-2 gap-6 pt-4">
                                <div>
                                    <h3 class="font-bold text-lg text-green-600 mb-2"><i class="fas fa-check-circle mr-2"></i>Your Strengths</h3>
                                    <ul id="strengths-list" class="list-disc list-inside text-slate-600"></ul>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg text-red-600 mb-2"><i class="fas fa-exclamation-triangle mr-2"></i>Areas for Review</h3>
                                    <ul id="weaknesses-list" class="list-disc list-inside text-slate-600"></ul>
                                </div>
                            </div>
                        </details>
                    </div>

                    <div class="grid grid-cols-7 gap-1 text-center font-bold text-slate-500 text-xs sm:text-sm mb-2">
                        <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
                    </div>
                    <div id="calendar-grid" class="grid grid-cols-7 gap-1"></div>
                </div>
            </div>

             <div id="theory-container" class="main-app-container hidden">
                <div id="theory-controls">
                    <h1 class="main-title">Theory Bank</h1>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="card p-6 text-center">
                            <i class="fas fa-layer-group text-4xl text-blue-500 mb-4"></i>
                            <h2 class="font-bold text-xl mb-2 text-slate-800">Flashcard Mode</h2>
                            <p class="text-slate-500 mb-4">Review all theory questions like flashcards to build your foundational knowledge.</p>
                            <button id="theory-flashcard-mode-btn" class="action-btn bg-blue-600 hover:bg-blue-700 text-white w-full">Start Flashcards</button>
                        </div>
                        <div class="card p-6 text-center">
                            <i class="fas fa-feather-alt text-4xl text-purple-500 mb-4"></i>
                            <h2 class="font-bold text-xl mb-2 text-slate-800">Thinking Exam Mode</h2>
                            <p class="text-slate-500 mb-4">Simulate an essay exam. You will be timed to think and structure your answer.</p>
                            <button id="theory-exam-mode-btn" class="action-btn bg-purple-600 hover:bg-purple-700 text-white w-full">Start Exam Mode</button>
                        </div>
                    </div>
                     <div class="mt-8 p-6 card">
                         <h2 class="font-bold text-xl mb-4 text-slate-800 text-center">Browse Theory Questions</h2>
                         <div class="flex justify-center gap-4">
                            <button id="theory-browse-by-chapter-btn" class="action-btn bg-indigo-600 hover:bg-indigo-700 text-white"><i class="fas fa-book-open mr-2"></i> By Chapter</button>
                            <button id="theory-browse-by-source-btn" class="action-btn bg-indigo-600 hover:bg-indigo-700 text-white"><i class="fas fa-file-alt mr-2"></i> By Source</button>
                         </div>
                         <div class="input-with-icon-container mt-4">
                            <i class="fas fa-search input-icon"></i>
                            <input type="text" id="theory-search-input" class="form-input w-full pl-10" placeholder="Search keywords (e.g., 'Z-plasty', 'TRAM flap')...">
                            <button id="theory-search-btn" class="absolute right-2 top-1/2 -translate-y-1/2 action-btn bg-slate-200 text-slate-700 px-3 py-1 text-sm">Search</button>
                         </div>
                    </div>
                </div>
                <div id="theory-viewer" class="hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h2 id="theory-session-title" class="text-xl font-bold text-slate-800"></h2>
                        <div id="theory-timer-container" class="font-bold text-lg hidden"><i class="far fa-clock mr-2"></i><span id="theory-timer">00:00</span></div>
                    </div>
                     <p id="theory-progress" class="text-center text-slate-500 mb-4"></p>
                     <div class="card p-6">
                         <p id="theory-question-text" class="text-lg font-semibold mb-4 text-slate-800"></p>
                         <div class="flex gap-4 items-center mb-4">
                            <button id="theory-show-answer-btn" class="action-btn bg-green-600 hover:bg-green-700 text-white">Show Model Answer</button>
                            <div class="flex items-center gap-2">
                               <button id="theory-status-not-covered-btn" class="status-btn" data-status="Not Covered"><i class="far fa-circle"></i></button>
                               <button id="theory-status-partially-covered-btn" class="status-btn" data-status="Partially Covered"><i class="fas fa-adjust"></i></button>
                               <button id="theory-status-fully-covered-btn" class="status-btn" data-status="Fully Covered"><i class="fas fa-check-circle"></i></button>
                            </div>
                            <button id="theory-note-btn" class="nav-btn bg-indigo-500 hover:bg-indigo-600 text-white"><i class="fas fa-edit"></i> Note</button>
                         </div>
                         <div id="theory-answer-container" class="mt-4 hidden">
                            <h3 class="font-bold text-slate-800">Model Answer:</h3>
                            <p id="theory-answer-text" class="text-slate-600 whitespace-pre-wrap"></p>
                            <h3 class="font-bold text-slate-800 mt-4">Keywords:</h3>
                            <p id="theory-keywords" class="text-slate-500"></p>
                         </div>
                     </div>
                      <div class="flex justify-between mt-6">
                        <button id="theory-prev-btn" class="nav-btn"><i class="fas fa-arrow-left mr-2"></i> Previous</button>
                        <button id="theory-next-btn" class="nav-btn">Next <i class="fas fa-arrow-right ml-2"></i></button>
                    </div>
                </div>
            </div>

            <div id="matching-menu-container" class="main-app-container hidden">
                <h1 class="main-title">Matching Bank</h1>
                <div class="card max-w-2xl mx-auto">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="matching-set-count" class="block text-sm font-bold text-slate-700 mb-2">Number of Sets (5 Questions/Set)</label>
                            <input type="number" id="matching-set-count" value="1" min="1" class="shadow appearance-none border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="matching-timer-input" class="block text-sm font-bold text-slate-700 mb-2">Time Per Set (Seconds)</label>
                            <input type="number" id="matching-timer-input" value="60" min="10" step="5" class="shadow appearance-none border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <div class="mt-6">
                        <details class="insights-details">
                            <summary class="insights-summary">Customize by Chapter & Source <i class="fas fa-chevron-down"></i></summary>
                            <div class="insights-content mt-4">
                                <h3 class="font-bold text-lg mb-2 text-slate-800">Filter by Chapter</h3>
                                <div id="chapter-select-matching" class="filter-grid"></div>
                                <h3 class="font-bold text-lg mt-6 mb-2 text-slate-800">Filter by Source</h3>
                                <div id="source-select-matching" class="filter-grid"></div>
                            </div>
                        </details>
                    </div>
                    <p id="matching-error" class="text-red-500 text-sm mt-4 hidden"></p>
                    <div class="text-center mt-8">
                        <button id="start-matching-exam-btn" class="action-btn bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg text-lg">
                            <i class="fas fa-play-circle mr-2"></i>Start Matching Exam
                        </button>
                    </div>
                </div>
            </div>

            <div id="matching-container" class="main-app-container hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="matching-exam-title" class="text-xl font-bold text-slate-800">Matching Exam</h2>
                    <div class="flex items-center gap-4">
                        <div class="font-bold text-lg"><i class="far fa-clock mr-2"></i><span id="matching-timer">00:00</span></div>
                        <div class="font-bold text-lg"><i class="far fa-star mr-2"></i><span id="matching-score">0</span> / <span id="matching-total">0</span></div>
                    </div>
                </div>
                <div id="matching-game-area" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="flex flex-col gap-3">
                        <h3 class="font-bold text-center text-slate-600">Premises</h3>
                        <div id="premises-container" class="space-y-3"></div>
                    </div>
                    <div class="flex flex-col gap-3">
                        <h3 class="font-bold text-center text-slate-600">Answers</h3>
                        <div id="answers-container" class="space-y-3"></div>
                    </div>
                </div>
                <div class="mt-6 text-center">
                    <button id="matching-next-set-btn" class="action-btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded hidden">Next Set <i class="fas fa-arrow-right ml-2"></i></button>
                    <button id="matching-check-answers-btn" class="action-btn bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded">Check Answers</button>
                </div>
                <p id="matching-set-indicator" class="text-center text-slate-500 mt-4"></p>
            </div>


        </main>
    </div>

    <div id="modal-backdrop" class="fixed inset-0 bg-black/50 z-40 hidden"></div>
    
    <div id="confirmation-modal" class="modal-container hidden">
        <div class="modal-content">
            <h3 id="modal-title" class="text-lg font-bold">Confirmation</h3>
            <p id="modal-message" class="mt-2 text-sm text-slate-600">Are you sure?</p>
            <div id="modal-custom-content" class="mt-4"></div>
            <div id="modal-buttons" class="flex justify-end gap-4 mt-6">
                <button id="modal-cancel-btn" class="action-btn bg-gray-300 hover:bg-gray-400 text-gray-800">Cancel</button>
                <button id="modal-confirm-btn" class="action-btn bg-blue-600 hover:bg-blue-700 text-white">Confirm</button>
            </div>
        </div>
    </div>

    <div id="image-viewer-modal" class="modal-container hidden items-center justify-center">
        <div class="bg-white p-4 rounded-lg shadow-xl max-w-4xl w-full relative">
            <button id="image-viewer-close-btn" class="absolute -top-3 -right-3 bg-white rounded-full h-8 w-8 flex items-center justify-center text-red-500 shadow-lg">&times;</button>
            <img id="modal-image" src="" alt="Enlarged view" class="max-w-full max-h-[80vh] mx-auto">
        </div>
    </div>
    
    <div id="note-modal" class="modal-container hidden">
        <div class="modal-content w-full max-w-lg">
            <h3 id="note-modal-title" class="text-lg font-bold">Add Note</h3>
            <textarea id="note-textarea" class="form-input w-full mt-4 h-48" placeholder="Type your note here..."></textarea>
            <div class="flex justify-end gap-4 mt-4">
                <button id="note-cancel-btn" class="action-btn bg-gray-300 hover:bg-gray-400 text-gray-800">Cancel</button>
                <button id="note-save-btn" class="action-btn bg-green-600 hover:bg-green-700 text-white">Save Note</button>
            </div>
        </div>
    </div>

    <div id="question-navigator-modal" class="modal-container hidden">
        <div class="modal-content w-full max-w-3xl">
            <div class="flex justify-between items-center">
                <h3 class="text-lg font-bold">Question Navigator</h3>
                <button id="navigator-close-btn" class="text-xl">&times;</button>
            </div>
            <div id="navigator-grid" class="grid grid-cols-5 sm:grid-cols-10 gap-2 mt-4"></div>
        </div>
    </div>

     <div id="osce-navigator-modal" class="modal-container hidden">
        <div class="modal-content w-full max-w-3xl">
            <div class="flex justify-between items-center">
                <h3 class="text-lg font-bold">OSCE Navigator</h3>
                <button id="osce-navigator-close-btn" class="text-xl">&times;</button>
            </div>
            <div id="osce-navigator-content" class="mt-4 space-y-4"></div>
        </div>
    </div>
    
    <div id="clear-log-modal" class="modal-container hidden">
        <div class="modal-content">
            <h3 class="text-lg font-bold">Clear Activity Log</h3>
            <p class="mt-2 text-sm text-slate-600">Which logs would you like to clear? This action cannot be undone.</p>
            <div class="flex justify-end gap-4 mt-6">
                <button id="clear-log-cancel-btn" class="action-btn bg-gray-400 hover:bg-gray-500">Cancel</button>
                <button id="clear-log-quiz-btn" class="action-btn bg-red-600 hover:bg-red-700">Quiz Logs Only</button>
                <button id="clear-log-all-btn" class="action-btn bg-red-800 hover:bg-red-900">Clear All</button>
            </div>
        </div>
    </div>
    
    <div id="announcements-modal" class="modal-container hidden">
        <div class="modal-content w-full max-w-lg">
             <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold"><i class="fas fa-bell mr-2 text-yellow-500"></i>Announcements</h3>
                <button id="announcements-close-btn" class="text-xl">&times;</button>
            </div>
            <div id="announcements-list" class="space-y-3 max-h-96 overflow-y-auto"></div>
        </div>
    </div>

    <div id="user-card-modal" class="modal-container hidden">
        <div class="modal-content max-w-lg">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">User Profile</h3>
                <button id="user-card-close-btn" class="text-xl">&times;</button>
            </div>
            <div class="text-center">
                <img id="card-user-avatar" src="" alt="User Avatar" class="w-24 h-24 rounded-full mx-auto mb-4 border-4 border-slate-200">
                <button id="change-avatar-btn" class="text-xs text-blue-500 hover:underline">Change</button>
            </div>
             <div id="user-card-view">
                <p class="text-center text-xl font-bold mt-2" id="card-user-name"></p>
                <p class="text-center text-slate-500" id="card-user-nickname"></p>
                <div class="mt-6 grid grid-cols-2 gap-4 text-center">
                     <div><p class="font-bold text-2xl" id="card-quiz-score"></p><p class="text-sm text-slate-400">Total Score</p></div>
                     <div><p class="font-bold text-2xl" id="card-days-left"></p><p class="text-sm text-slate-400">Days to Exam</p></div>
                </div>
                 <div id="card-subscription-status" class="mt-4 text-center text-sm p-2 rounded-lg"></div>
                <p id="card-subscription-expiry" class="mt-1 text-center text-xs text-slate-400"></p>
             </div>
             <div id="user-card-edit" class="hidden mt-4">
                 <div class="mb-4">
                    <label for="edit-nickname" class="block text-sm font-bold text-slate-700 mb-2">Nickname</label>
                    <input type="text" id="edit-nickname" class="form-input w-full" placeholder="Enter a nickname">
                </div>
                 <div class="mb-4">
                    <label for="edit-exam-date" class="block text-sm font-bold text-slate-700 mb-2">Exam Date</label>
                    <input type="date" id="edit-exam-date" class="form-input w-full">
                </div>
             </div>
            <div class="flex justify-end gap-4 mt-6">
                <button id="messenger-btn" class="action-btn bg-purple-600 hover:bg-purple-700"><i class="fas fa-envelope"></i> Contact Support</button>
                <button id="edit-profile-btn" class="action-btn bg-blue-600 hover:bg-blue-700">Edit Profile</button>
                <button id="save-profile-btn" class="action-btn bg-green-600 hover:bg-green-700 hidden">Save Changes</button>
            </div>
        </div>
    </div>
    
    <div id="messenger-modal" class="modal-container hidden">
         <div class="modal-content w-full max-w-md flex flex-col h-[70vh]">
            <div class="flex justify-between items-center mb-4 pb-2 border-b">
                <h3 class="text-lg font-bold"><i class="fas fa-headset mr-2 text-purple-500"></i>Support Chat</h3>
                <button id="messenger-close-btn" class="text-xl">&times;</button>
            </div>
            <div id="messenger-body" class="flex-grow overflow-y-auto p-2 space-y-4"></div>
            <p id="messenger-error" class="text-red-500 text-sm mt-2 hidden"></p>
            <div class="mt-4 flex gap-2">
                <input type="text" id="message-input" class="form-input w-full" placeholder="Type your message...">
                <button id="send-message-btn" class="action-btn bg-blue-600 hover:bg-blue-700 text-white px-4"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <div id="registration-modal" class="modal-container hidden">
        <div class="modal-content w-full max-w-lg">
            <h3 class="text-2xl font-bold text-center mb-6">Create a New Account</h3>
            <form id="registration-form" class="space-y-4">
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                     <input type="text" id="register-name" class="form-input" placeholder="Full Name" required>
                     <input type="text" id="register-username" class="form-input" placeholder="Username" required>
                 </div>
                 <input type="email" id="register-email" class="form-input" placeholder="Email Address" required>
                 <input type="tel" id="register-mobile" class="form-input" placeholder="Mobile Number" required>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="password" id="register-password" class="form-input" placeholder="Password (min. 6 characters)" required>
                    <input type="password" id="register-confirm-password" class="form-input" placeholder="Confirm Password" required>
                 </div>
                 <select id="register-country" class="form-input" required>
                     <option value="">Select Country</option>
                     </select>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <select id="register-study-type" class="form-input">
                        <option value="">Select Study Type</option>
                        <option value="Medical Student">Medical Student</option>
                        <option value="Resident">Resident</option>
                        <option value="Specialist">Specialist</option>
                    </select>
                    <input type="text" onfocus="(this.type='date')" onblur="(this.type='text')" id="register-exam-date" class="form-input" placeholder="Exam Date (Optional)">
                 </div>
                 
                 <p id="registration-error" class="text-red-500 text-sm hidden"></p>
                 <p id="registration-success" class="text-green-600 text-sm hidden"></p>

                <div class="flex justify-end gap-4 pt-4">
                    <button type="button" id="register-cancel-btn" class="action-btn bg-gray-300 hover:bg-gray-400 text-gray-800">Cancel</button>
                    <button type="submit" id="register-submit-btn" class="action-btn bg-blue-600 hover:bg-blue-700 text-white">Register</button>
                </div>
            </form>
        </div>
    </div>

    <div id="create-plan-modal" class="modal-container hidden">
        <div class="modal-content w-full max-w-lg">
            <h3 class="text-lg font-bold mb-4">Create New Study Plan</h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="sm:col-span-2">
                    <label for="new-plan-name" class="block text-sm font-bold text-slate-700 mb-2">Plan Name</label>
                    <input type="text" id="new-plan-name" class="shadow appearance-none border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Final Revision Plan">
                </div>
                <div>
                    <label for="new-plan-start-date" class="block text-sm font-bold text-slate-700 mb-2">Start Date</label>
                    <input type="date" id="new-plan-start-date" class="shadow appearance-none border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="new-plan-end-date" class="block text-sm font-bold text-slate-700 mb-2">End Date</label>
                    <input type="date" id="new-plan-end-date" class="shadow appearance-none border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </div>
            <p id="create-plan-error" class="text-red-500 text-xs italic mt-4 hidden"></p>
            <div class="flex justify-end gap-4 mt-6">
                <button id="cancel-create-plan-btn" class="action-btn bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded">Cancel</button>
                <button id="confirm-create-plan-btn" class="action-btn bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Create Plan</button>
            </div>
        </div>
    </div>


    <script src="js/login-animation.js"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>
