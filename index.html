<!DOCTYPE html>
<html lang="en" dir="ltr" class="light"> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Plasticology Ultimate Edition</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e293b">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://pub-fb0d46cb77cb4e22b5863540fe118da4.r2.dev/Plasticology%202025%20Logo%20white%20outline.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class', // Ÿáÿ∞ÿß ÿßŸÑÿ≥ÿ∑ÿ± Ÿäÿ¨ÿ®ÿ±Ÿá ÿπŸÑŸâ ÿßŸÜÿ™ÿ∏ÿßÿ± ÿ£ŸÖÿ± ŸÖŸÜŸÉ ŸÑÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÑŸäŸÑŸä
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="flex items-center justify-center min-h-screen bg-slate-100 text-slate-800 overflow-hidden">

    <canvas id="login-canvas"></canvas>

    <div id="settings-container">
        <button id="toggle-animation-btn" title="Toggle Animation">
            <i class="fas fa-play-circle animation-on-icon"></i>
            <i class="fas fa-pause-circle animation-off-icon"></i>
        </button>
        <button id="toggle-theme-btn" title="Toggle Theme">
            <i class="fas fa-sun sun-icon"></i>
            <i class="fas fa-moon moon-icon"></i>
        </button>
    </div>

    <div class="app-shell w-full h-full flex flex-col md:flex-row overflow-hidden">
        
        <aside id="desktop-sidebar" class="hidden md:flex flex-col w-64 bg-slate-900 text-white h-screen shadow-2xl z-50 transition-all duration-300">
            <div class="p-6 flex items-center justify-center border-b border-slate-700">
                 <img src="https://pub-fb0d46cb77cb4e22b5863540fe118da4.r2.dev/Plasticology%202025%20Logo%20white%20outline.png" alt="Logo" class="h-12 invert">
            </div>
            
            <nav class="flex-1 overflow-y-auto py-4 px-2 space-y-1">
                <p class="px-4 text-xs font-semibold text-slate-400 uppercase tracking-wider mt-2 mb-1">Main</p>
                <button id="sidebar-home-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-slate-800 transition-colors">
                    <i class="fas fa-home w-6 text-center mr-3"></i> Dashboard
                </button>
                <button id="sidebar-lectures-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-slate-800 transition-colors">
                    <i class="fas fa-video w-6 text-center mr-3 text-teal-400"></i> Lectures
                </button>
                <button id="sidebar-qbank-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-slate-800 transition-colors">
                    <i class="fas fa-question-circle w-6 text-center mr-3 text-indigo-400"></i> Exams & QBank
                </button>
                <button id="sidebar-planner-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-slate-800 transition-colors">
                    <i class="fas fa-calendar-alt w-6 text-center mr-3 text-purple-400"></i> Study Planner
                </button>

                <p class="px-4 text-xs font-semibold text-slate-400 uppercase tracking-wider mt-6 mb-1">Practice</p>
                <button id="sidebar-learning-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-slate-800 transition-colors">
                    <i class="fas fa-book-reader w-6 text-center mr-3 text-green-400"></i> Learning Mode
                </button>
                <button id="sidebar-matching-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-slate-800 transition-colors">
                    <i class="fas fa-puzzle-piece w-6 text-center mr-3 text-pink-400"></i> Matching
                </button>
                <button id="sidebar-osce-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-slate-800 transition-colors">
                    <i class="fas fa-user-md w-6 text-center mr-3 text-sky-400"></i> OSCE Cases
                </button>
                 <button id="sidebar-theory-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-slate-800 transition-colors">
                    <i class="fas fa-book-medical w-6 text-center mr-3 text-yellow-400"></i> Theory Bank
                </button>

                <p class="px-4 text-xs font-semibold text-slate-400 uppercase tracking-wider mt-6 mb-1">Tools</p>
                <button id="sidebar-library-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-slate-800 transition-colors">
                    <i class="fas fa-book-bookmark w-6 text-center mr-3"></i> Library
                </button>
                <button id="sidebar-notes-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-slate-800 transition-colors">
                    <i class="fas fa-sticky-note w-6 text-center mr-3"></i> My Notes
                </button>
                <button id="sidebar-activity-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-slate-800 transition-colors">
                    <i class="fas fa-history w-6 text-center mr-3"></i> Activity Log
                </button>
                <button id="sidebar-radio-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center hover:bg-slate-800 transition-colors">
                    <i class="fas fa-broadcast-tower w-6 text-center mr-3"></i> Radio
                </button>
            </nav>

            <div class="p-4 border-t border-slate-700 bg-slate-950">
                 <button id="sidebar-profile-btn" class="flex items-center w-full p-2 rounded-lg hover:bg-slate-800 transition-colors">
                    <img id="sidebar-user-avatar" src="https://api.dicebear.com/7.x/initials/svg?seed=Dr" class="w-10 h-10 rounded-full border border-slate-500">
                    <div class="ml-3 text-left overflow-hidden">
                        <p id="sidebar-user-name" class="text-sm font-bold text-white truncate">Dr. User</p>
                        <p class="text-xs text-slate-400">View Profile</p>
                    </div>
                </button>
            </div>
        </aside>

        <div class="flex-1 flex flex-col h-screen overflow-hidden relative bg-slate-50 dark:bg-slate-900 transition-colors">
            
            <header id="global-header" class="hidden h-16 bg-white dark:bg-slate-800 shadow-sm z-20 px-4 md:px-8 flex items-center justify-between transition-colors">
                <div class="md:hidden flex items-center">
                    <img src="https://pub-fb0d46cb77cb4e22b5863540fe118da4.r2.dev/Plasticology%202025%20Logo%20white%20outline.png" class="h-8 invert dark:invert-0">
                </div>
                <div class="flex-1 max-w-xl mx-4 hidden sm:block">
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-slate-400"><i class="fas fa-search"></i></span>
                        <input type="text" class="w-full py-2 pl-10 pr-4 bg-slate-100 dark:bg-slate-700 border-none rounded-full text-sm focus:ring-2 focus:ring-blue-500 dark:text-white transition-all" placeholder="Search...">
                    </div>
                </div>
                <div class="flex items-center gap-3">
                     <div id="streak-container" class="hidden md:flex items-center bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 px-3 py-1 rounded-full text-sm font-bold border border-orange-200 dark:border-orange-800">
                        <i class="fas fa-fire mr-1.5"></i><span id="streak-count">0</span>
                    </div>
                    <button id="announcements-btn" class="relative p-2 text-slate-500 hover:text-blue-600 dark:text-slate-300 transition-colors rounded-full hover:bg-slate-100 dark:hover:bg-slate-700">
                        <i class="fas fa-bell text-xl"></i>
                    </button>
                    <button id="messenger-btn" class="relative p-2 text-slate-500 hover:text-blue-600 dark:text-slate-300 transition-colors rounded-full hover:bg-slate-100 dark:hover:bg-slate-700">
                        <i class="fas fa-comment-alt text-xl"></i>
                    </button>
                    <button id="mobile-profile-btn" class="md:hidden ml-1">
                        <img id="header-user-avatar" src="https://api.dicebear.com/7.x/initials/svg?seed=User" class="w-8 h-8 rounded-full border border-slate-300">
                    </button>
                </div>
            </header>
            
            <main id="main-content" class="flex-1 overflow-y-auto overflow-x-hidden p-0 relative scroll-smooth">
                 <div id="watermark-overlay" class="hidden"></div>

                 <div id="login-container" class="w-full min-h-screen flex flex-col items-center justify-center p-4 bg-opacity-90 relative z-50">
                     <div class="login-card p-8 rounded-2xl shadow-2xl max-w-sm w-full bg-white/90 dark:bg-slate-800/90 backdrop-blur-md border border-white/20">
                        <img id="login-logo" src="https://pub-fb0d46cb77cb4e22b5863540fe118da4.r2.dev/Plasticology%202025%20Logo%20white%20outline.png" alt="Logo" class="h-20 mx-auto mb-4 invert dark:invert-0">
                        <div class="text-center mb-8">
                            <h1 class="text-2xl font-bold text-slate-800 dark:text-white">Plasticology</h1>
                            <p class="text-slate-500 dark:text-slate-400 mt-1 text-sm">Ultimate Edition v3.1</p>
                        </div>
                        <div id="pwa-install-banner" class="hidden mb-6 p-3 bg-indigo-50 dark:bg-indigo-900/30 border border-indigo-100 dark:border-indigo-800 rounded-xl text-center">
                            <button id="pwa-install-btn" class="w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg text-xs">Install App</button>
                        </div>
                        <div id="login-loader" class="loader hidden"></div>
                        <p id="login-loading-text" class="text-center text-slate-500 text-sm hidden mb-4">Authenticating...</p>
                        <form id="login-form" class="space-y-5">
                            <div class="input-with-icon-container">
                                <i class="fas fa-user input-icon z-10"></i>
                                <input type="text" id="username" autocomplete="off" class="input-with-icon pl-10 shadow-sm border rounded-lg w-full py-3 px-3 dark:bg-slate-700 dark:border-slate-600 dark:text-white" placeholder="Username" required>
                            </div>
                            <div class="input-with-icon-container">
                                <i class="fas fa-lock input-icon z-10"></i>
                                <input type="password" id="password" autocomplete="off" class="input-with-icon pl-10 shadow-sm border rounded-lg w-full py-3 px-3 dark:bg-slate-700 dark:border-slate-600 dark:text-white" placeholder="Password" required>
                            </div>
                            <p id="login-error" class="text-red-500 text-xs italic hidden text-center">Invalid username or password.</p>
                            <button type="submit" id="login-submit-btn" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg">Log In</button>
                        </form>
                        <div class="mt-6 text-center space-y-3">
                             <a href="#" id="show-register-link" class="text-sm text-blue-600 dark:text-blue-400">Create Account</a>
                             <div class="grid grid-cols-2 gap-3 mt-4">
                                <button type="button" id="free-test-btn" class="text-xs bg-slate-100 dark:bg-slate-700 py-2 px-3 rounded-lg">Free Test</button>
                                <a href="https://www.youtube.com/playlist?list=PLVUDV5bqFz4jabLMYet03YmJknm8jA-wG" target="_blank" class="text-xs bg-slate-100 dark:bg-slate-700 py-2 px-3 rounded-lg">Samples</a>
                            </div>
                        </div>
                     </div>
                 </div>

                 <div id="main-menu-container" class="hidden p-4 md:p-8 max-w-6xl mx-auto space-y-6 pb-24 md:pb-8">
                    <div class="bg-gradient-to-r from-blue-600 to-indigo-700 rounded-2xl p-6 text-white shadow-lg relative overflow-hidden">
                        <div class="absolute top-0 right-0 opacity-10 transform translate-x-10 -translate-y-10"><i class="fas fa-user-md text-9xl"></i></div>
                        <div class="relative z-10">
                            <h2 class="text-2xl md:text-3xl font-bold mb-2">Good Morning, <span id="dashboard-user-name">Doctor</span>! üëã</h2>
                            <div id="last-activity-container" class="flex flex-wrap gap-2 mt-2">
                                <div id="last-lecture-ribbon" class="hidden bg-white/20 backdrop-blur-sm px-3 py-1 rounded-full text-xs border border-white/30 cursor-pointer">Resume Lecture</div>
                                <div id="last-quiz-ribbon" class="hidden bg-white/20 backdrop-blur-sm px-3 py-1 rounded-full text-xs border border-white/30 cursor-pointer">Review Quiz</div>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                         <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700">
                            <div class="text-xs font-bold uppercase mb-1 text-slate-500">Streak</div>
                            <div class="flex items-center text-orange-500"><i class="fas fa-fire text-xl mr-2"></i><span class="text-2xl font-bold text-slate-800 dark:text-white" id="dashboard-streak">0</span></div>
                        </div>
                         <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700">
                            <div class="text-xs font-bold uppercase mb-1 text-slate-500">Score</div>
                            <div class="flex items-center text-blue-500"><i class="fas fa-star text-xl mr-2"></i><span class="text-2xl font-bold text-slate-800 dark:text-white" id="dashboard-score">0</span></div>
                        </div>
                        <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 col-span-2 md:col-span-2">
                             <div class="text-xs font-bold uppercase mb-1 text-slate-500">Next Exam</div>
                             <div class="flex items-center justify-between">
                                <div class="text-lg font-bold text-slate-800 dark:text-white truncate" id="dashboard-exam-date">Not Set</div>
                                <div class="text-xs bg-red-100 text-red-600 px-2 py-1 rounded font-bold" id="dashboard-days-left">-- Days</div>
                             </div>
                        </div>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800 dark:text-white mt-4">Study Areas</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <button id="lectures-btn" class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 flex flex-col items-center text-center group hover:shadow-md">
                            <div class="w-14 h-14 bg-teal-100 dark:bg-teal-900/30 rounded-full flex items-center justify-center mb-3"><i class="fas fa-video text-2xl text-teal-600 dark:text-teal-400"></i></div>
                            <span class="font-bold text-slate-700 dark:text-slate-200">Lectures</span>
                        </button>
                        <button id="qbank-btn" class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 flex flex-col items-center text-center group hover:shadow-md">
                            <div class="w-14 h-14 bg-indigo-100 dark:bg-indigo-900/30 rounded-full flex items-center justify-center mb-3"><i class="fas fa-question-circle text-2xl text-indigo-600 dark:text-indigo-400"></i></div>
                            <span class="font-bold text-slate-700 dark:text-slate-200">Q-Bank</span>
                        </button>
                         <button id="study-planner-btn" class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 flex flex-col items-center text-center group hover:shadow-md">
                            <div class="w-14 h-14 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center mb-3"><i class="fas fa-calendar-alt text-2xl text-purple-600 dark:text-purple-400"></i></div>
                            <span class="font-bold text-slate-700 dark:text-slate-200">Study Plan</span>
                        </button>
                         <button id="matching-btn" class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 flex flex-col items-center text-center group hover:shadow-md">
                            <div class="w-14 h-14 bg-pink-100 dark:bg-pink-900/30 rounded-full flex items-center justify-center mb-3"><i class="fas fa-puzzle-piece text-2xl text-pink-600 dark:text-pink-400"></i></div>
                            <span class="font-bold text-slate-700 dark:text-slate-200">Matching</span>
                        </button>
                        <button id="osce-btn" class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 flex flex-col items-center text-center group hover:shadow-md">
                            <div class="w-14 h-14 bg-sky-100 dark:bg-sky-900/30 rounded-full flex items-center justify-center mb-3"><i class="fas fa-user-md text-2xl text-sky-600 dark:text-sky-400"></i></div>
                            <span class="font-bold text-slate-700 dark:text-slate-200">OSCE</span>
                        </button>
                        <button id="learning-mode-btn" class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 flex flex-col items-center text-center group hover:shadow-md">
                            <div class="w-14 h-14 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mb-3"><i class="fas fa-book-reader text-2xl text-green-600 dark:text-green-400"></i></div>
                            <span class="font-bold text-slate-700 dark:text-slate-200">Learning</span>
                        </button>
                        <button id="leaderboard-btn" class="md:flex hidden bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 flex-col items-center text-center hover:shadow-md">
                            <div class="w-14 h-14 bg-rose-100 dark:bg-rose-900/30 rounded-full flex items-center justify-center mb-3"><i class="fas fa-trophy text-2xl text-rose-600 dark:text-rose-400"></i></div>
                            <span class="font-bold text-slate-700 dark:text-slate-200">Leaderboard</span>
                        </button>
                        <button id="library-btn" class="md:flex hidden bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 flex-col items-center text-center hover:shadow-md">
                            <div class="w-14 h-14 bg-amber-100 dark:bg-amber-900/30 rounded-full flex items-center justify-center mb-3"><i class="fas fa-book-bookmark text-2xl text-amber-600 dark:text-amber-400"></i></div>
                            <span class="font-bold text-slate-700 dark:text-slate-200">Library</span>
                        </button>
                        <button id="theory-btn" class="hidden"></button> 
                        <button id="activity-log-btn" class="hidden"></button>
                        <button id="notes-btn" class="hidden"></button>
                        <button id="radio-btn" class="hidden"></button>
                        <button id="user-profile-header-btn" class="hidden"></button>
                        <button id="global-home-btn" class="hidden"></button>
                    </div>
                 </div>

                 <div id="lectures-container" class="w-full hidden pb-20">
                    <div class="sticky top-0 z-10 p-4 bg-white dark:bg-slate-800 border-b dark:border-slate-700 flex justify-between items-center shadow-sm">
                        <button id="lectures-back-btn" class="text-slate-600 dark:text-slate-300 hover:text-blue-600"><i class="fas fa-arrow-left mr-2"></i> Back</button>
                        <h2 class="text-xl font-bold text-slate-800 dark:text-white">Lectures</h2>
                        <div class="w-16"></div>
                    </div>
                    <div class="p-4 md:p-6 max-w-5xl mx-auto">
                        <div class="relative mb-6">
                            <input type="text" id="lecture-search-input" placeholder="Search chapters..." class="w-full p-3 pl-10 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-teal-500">
                            <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                        </div>
                        <div id="lectures-loader" class="loader"></div>
                        <div id="lectures-list" class="space-y-4"></div>
                    </div>
                 </div>

                 <div id="qbank-container" class="w-full hidden pb-20">
                    <div class="sticky top-0 z-10 p-4 bg-white dark:bg-slate-800 border-b dark:border-slate-700 flex justify-between items-center shadow-sm">
                         <button id="qbank-back-btn" class="text-slate-600 dark:text-slate-300 hover:text-blue-600"><i class="fas fa-arrow-left mr-2"></i> Back</button>
                         <h2 class="text-xl font-bold text-slate-800 dark:text-white">Exam Mode</h2>
                         <div class="w-16"></div>
                    </div>
                    <div class="p-4 md:p-8 max-w-5xl mx-auto">
                        <div class="mb-6">
                             <div class="flex gap-2">
                                <input type="text" id="qbank-search-input" class="w-full p-3 border rounded-xl dark:bg-slate-700 dark:border-slate-600 dark:text-white" placeholder="Search topic (e.g. Flaps)">
                                <button id="qbank-search-btn" class="bg-indigo-600 text-white px-6 rounded-xl font-bold">Search</button>
                             </div>
                             <p id="qbank-search-error" class="text-red-500 text-xs mt-2 hidden"></p>
                             <div id="qbank-search-results-container" class="hidden mt-4 p-4 bg-white dark:bg-slate-800 rounded-xl shadow">
                                <p id="qbank-search-results-info" class="mb-2 dark:text-white"></p>
                                <div class="flex gap-2">
                                    <input type="number" id="qbank-search-q-count" class="border rounded-lg p-2 w-24" placeholder="Count">
                                    <button id="qbank-start-search-quiz-btn" class="bg-emerald-600 text-white px-4 py-2 rounded-lg">Start</button>
                                </div>
                             </div>
                             <button id="qbank-clear-search-btn" class="hidden"></button>
                        </div>
                        <div class="flex border-b border-slate-200 dark:border-slate-700 mb-4">
                            <button id="qbank-tab-create" class="tab-btn active px-4 py-2 font-bold text-indigo-600 border-b-2 border-indigo-600">Create Exam</button>
                            <button id="qbank-tab-practice" class="tab-btn px-4 py-2 text-slate-500">Practice</button>
                            <button id="qbank-tab-browse" class="tab-btn px-4 py-2 text-slate-500">Browse</button>
                        </div>
                        <div id="qbank-panel-create" class="qbank-panel space-y-4">
                            <details class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden group">
                                <summary class="p-4 cursor-pointer flex justify-between items-center font-bold text-slate-800 dark:text-white hover:bg-slate-50 dark:hover:bg-slate-700">
                                    <div class="flex items-center"><i class="fas fa-tasks text-emerald-500 mr-3"></i> Quick Mock Exam</div>
                                    <i class="fas fa-chevron-down text-slate-400 group-open:rotate-180 transition-transform"></i>
                                </summary>
                                <div class="p-4 border-t dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50">
                                    <div id="loader" class="loader hidden"></div>
                                    <div class="grid grid-cols-2 gap-4 mb-4">
                                        <input type="number" id="mock-q-count" class="p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white" placeholder="# Questions">
                                        <input type="number" id="custom-timer-input" class="p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600 dark:text-white" placeholder="Sec/Question">
                                    </div>
                                    <button id="toggle-custom-options-btn" class="text-sm text-blue-600 font-bold mb-3">Customize Sources & Chapters <i class="fas fa-chevron-down"></i></button>
                                    <div id="custom-exam-options" class="custom-exam-options hidden mb-4">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                             <div class="bg-white dark:bg-slate-700 p-3 rounded-lg h-40 overflow-y-auto border">
                                                 <p class="text-xs font-bold text-slate-500 mb-2">Sources</p>
                                                 <div id="source-select-mock">Loading...</div>
                                                 <input id="select-all-sources-mock" type="checkbox" class="hidden">
                                             </div>
                                             <div class="bg-white dark:bg-slate-700 p-3 rounded-lg h-40 overflow-y-auto border">
                                                 <p class="text-xs font-bold text-slate-500 mb-2">Chapters</p>
                                                 <div id="chapter-select-mock">Loading...</div>
                                                 <input id="select-all-chapters-mock" type="checkbox" class="hidden">
                                             </div>
                                        </div>
                                    </div>
                                    <button id="start-mock-btn" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 rounded-lg shadow-md transition-transform active:scale-95">Start Exam</button>
                                    <p id="mock-error" class="text-red-500 text-xs mt-2 hidden"></p>
                                </div>
                            </details>

                             <details class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden group">
                                <summary class="p-4 cursor-pointer flex justify-between items-center font-bold text-slate-800 dark:text-white hover:bg-slate-50 dark:hover:bg-slate-700">
                                    <div class="flex items-center"><i class="fas fa-flag-checkered text-rose-500 mr-3"></i> Full Simulation Mode</div>
                                    <i class="fas fa-chevron-down text-slate-400 group-open:rotate-180 transition-transform"></i>
                                </summary>
                                <div class="p-4 border-t dark:border-slate-700 bg-rose-50 dark:bg-rose-900/10">
                                    <p class="text-sm text-slate-600 dark:text-slate-300 mb-4">Real exam experience: 100 Questions in 120 Minutes.</p>
                                    <button id="toggle-simulation-options-btn" class="text-sm text-blue-600 font-bold mb-3">Filter Scope (Optional)</button>
                                    <div id="simulation-custom-options" class="hidden mb-4">
                                         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                             <div class="bg-white dark:bg-slate-700 p-3 rounded-lg h-40 overflow-y-auto border"><div id="source-select-sim">Loading...</div></div>
                                             <div class="bg-white dark:bg-slate-700 p-3 rounded-lg h-40 overflow-y-auto border"><div id="chapter-select-sim">Loading...</div></div>
                                             <input id="select-all-sources-sim" type="checkbox" class="hidden"><input id="select-all-chapters-sim" type="checkbox" class="hidden">
                                        </div>
                                    </div>
                                    <button id="start-simulation-btn" class="w-full bg-rose-600 hover:bg-rose-700 text-white font-bold py-3 rounded-lg shadow-md">Start Simulation</button>
                                    <p id="simulation-error" class="text-red-500 text-xs mt-2 hidden"></p>
                                </div>
                             </details>
                        </div>
                        <div id="qbank-panel-practice" class="qbank-panel hidden space-y-4">
                             <button id="practice-mistakes-btn" class="w-full bg-orange-100 text-orange-800 font-bold py-4 rounded-xl hover:bg-orange-200">Practice Mistakes</button>
                             <button id="practice-bookmarked-btn" class="w-full bg-blue-100 text-blue-800 font-bold py-4 rounded-xl hover:bg-blue-200">Practice Bookmarked</button>
                        </div>
                        <div id="qbank-panel-browse" class="qbank-panel hidden space-y-4">
                            <button id="browse-by-chapter-btn" class="w-full bg-slate-100 text-slate-800 font-bold py-4 rounded-xl">Browse by Chapter</button>
                            <button id="browse-by-source-btn" class="w-full bg-slate-100 text-slate-800 font-bold py-4 rounded-xl">Browse by Source</button>
                        </div>
                    </div>
                 </div>

                 <div id="quiz-container" class="w-full hidden flex flex-col h-full bg-white dark:bg-slate-900 z-50 absolute inset-0">
                    <div class="p-4 bg-slate-100 dark:bg-slate-800 border-b dark:border-slate-700 flex justify-between items-center shadow-sm">
                        <button id="end-quiz-btn" class="text-red-500 hover:text-red-700 text-lg"><i class="fas fa-stop-circle mr-1"></i> End</button>
                        <h2 id="quiz-title" class="hidden md:block font-bold">Quiz</h2>
                        <div id="timer" class="font-mono font-bold text-slate-800 dark:text-white bg-slate-200 dark:bg-slate-700 px-3 py-1 rounded">00:00</div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-4 md:p-8 pb-24">
                         <div class="mb-4">
                            <div class="flex justify-between text-xs font-bold text-slate-500 mb-1"><span>Progress</span> <span id="score-progress-text">0/0</span></div>
                            <div class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2 overflow-hidden">
                                <div class="flex h-full">
                                    <div id="score-bar-correct" class="bg-emerald-500 w-0 transition-all"></div>
                                    <div id="score-bar-incorrect" class="bg-red-500 w-0 transition-all"></div>
                                </div>
                            </div>
                         </div>
                         <div id="question-container" class="max-w-3xl mx-auto">
                             <p id="source-text" class="text-xs text-slate-400 mb-2 text-center"></p>
                             <div id="question-image-container" class="mb-4 flex justify-center"></div>
                             <h2 id="question-text" class="text-lg md:text-xl font-bold text-slate-800 dark:text-white mb-6 leading-relaxed">Loading...</h2>
                             <div id="answer-buttons-quiz" class="grid grid-cols-1 gap-3"></div>
                             <div id="hint-text" class="hidden mt-4 p-4 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 text-sm rounded"></div>
                             <p id="progress-text" class="hidden"></p>
                         </div>
                         <div id="results-container" class="hidden text-center py-10">
                             <i class="fas fa-trophy text-6xl text-yellow-400 mb-4"></i>
                             <h2 id="results-title" class="text-3xl font-bold text-slate-800 dark:text-white mb-2">Quiz Complete!</h2>
                             <p class="text-xl text-slate-600 dark:text-slate-300 mb-8">Score: <span id="score-text" class="font-bold"></span> / <span id="total-questions"></span></p>
                             <div class="flex flex-col gap-3 max-w-xs mx-auto">
                                 <button id="results-home-btn" class="bg-slate-600 text-white py-3 rounded-lg font-bold">Dashboard</button>
                                 <button id="restart-btn" class="bg-blue-600 text-white py-3 rounded-lg font-bold">Restart</button>
                                 <button id="review-incorrect-btn" class="bg-red-100 text-red-600 py-3 rounded-lg font-bold hidden">Review Mistakes</button>
                                 <button id="review-simulation-btn" class="hidden"></button>
                             </div>
                         </div>
                    </div>
                    <div id="controls-container" class="p-4 bg-white dark:bg-slate-800 border-t dark:border-slate-700 flex justify-between items-center absolute bottom-0 w-full">
                         <button id="previous-btn" class="p-3 text-slate-500 hover:bg-slate-100 rounded-full"><i class="fas fa-chevron-left"></i></button>
                         <div class="flex gap-4 text-xl text-slate-400">
                             <button id="bookmark-btn"><i class="far fa-bookmark"></i></button>
                             <button id="flag-btn"><i class="far fa-flag"></i></button>
                             <button id="quiz-note-btn"><i class="fas fa-sticky-note"></i></button>
                             <button id="hint-btn"><i class="fas fa-lightbulb"></i></button>
                             <button id="navigator-btn"><i class="fas fa-th"></i></button>
                         </div>
                         <button id="next-skip-btn" class="bg-blue-600 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-blue-700">Next</button>
                    </div>
                 </div>

                 <div id="matching-container" class="w-full hidden pb-20">
                     <div class="p-4 border-b flex justify-between bg-white dark:bg-slate-800 dark:border-slate-700">
                         <button id="matching-back-btn"><i class="fas fa-arrow-left"></i> Back</button>
                         <h2 class="font-bold">Matching</h2>
                         <div></div>
                     </div>
                     <div id="matching-menu-container" class="p-4">
                         <div class="max-w-md mx-auto bg-white dark:bg-slate-800 p-6 rounded-xl shadow">
                             <label class="block text-sm font-bold mb-2">Number of Sets</label>
                             <input type="number" id="matching-set-count" class="w-full p-2 border rounded mb-4" placeholder="10">
                             <label class="block text-sm font-bold mb-2">Time (Sec)</label>
                             <input type="number" id="matching-timer-input" class="w-full p-2 border rounded mb-4" placeholder="60">
                             <div id="chapter-select-matching" class="hidden"></div>
                             <div id="source-select-matching" class="hidden"></div>
                             <button id="start-matching-btn" class="w-full bg-pink-600 text-white py-3 rounded-lg font-bold">Start Game</button>
                             <p id="matching-error" class="hidden text-red-500"></p>
                         </div>
                     </div>
                     <div id="matching-game-container" class="hidden h-full flex flex-col p-4">
                          <div class="flex justify-between items-center mb-4">
                              <div id="matching-score" class="font-bold text-blue-600">Score: 0</div>
                              <span id="matching-progress"></span>
                              <div id="matching-timer" class="font-mono bg-slate-200 px-2 rounded">00:00</div>
                              <button id="end-matching-btn" class="text-red-500"><i class="fas fa-stop"></i></button>
                          </div>
                          <div class="matching-container-grid flex-1 overflow-y-auto">
                              <div id="matching-premises-area"></div>
                              <div id="matching-answers-area"></div>
                          </div>
                          <button id="matching-submit-btn" class="w-full bg-green-600 text-white py-3 mt-2 rounded-lg font-bold">Check</button>
                          <button id="matching-next-btn" class="hidden w-full bg-blue-600 text-white py-3 mt-2 rounded-lg font-bold">Next Set</button>
                     </div>
                 </div>

                 <div id="osce-container" class="w-full hidden pb-20">
                    <div class="p-4 border-b flex justify-between bg-white dark:bg-slate-800 dark:border-slate-700">
                        <button id="osce-back-btn"><i class="fas fa-arrow-left"></i> Back</button>
                        <h2 class="font-bold">OSCE</h2>
                        <div></div>
                    </div>
                    <div id="osce-controls" class="p-6 max-w-2xl mx-auto space-y-4">
                         <button id="start-osce-slayer-btn" class="w-full bg-rose-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg">Start OSCE Slayer ‚öîÔ∏è</button>
                         <div class="text-center text-slate-400 font-bold">- OR -</div>
                         <div class="flex gap-2">
                             <input type="number" id="osce-case-count" class="flex-1 p-3 border rounded-lg" placeholder="# Cases">
                             <input type="number" id="osce-time-per-q" class="flex-1 p-3 border rounded-lg" placeholder="Min/Q">
                             <button id="start-custom-osce-btn" class="flex-1 bg-sky-600 text-white font-bold rounded-lg">Custom</button>
                             <button id="toggle-osce-options-btn" class="hidden"></button>
                         </div>
                         <div id="custom-osce-options" class="hidden"><div id="chapter-select-osce"></div><div id="source-select-osce"></div></div>
                         <p id="osce-error" class="hidden text-red-500"></p>
                    </div>
                    <div id="osce-quiz-container" class="hidden h-full flex flex-col">
                         <div class="p-2 bg-slate-100 flex justify-between">
                             <button id="end-osce-quiz-btn" class="text-red-500">Exit</button>
                             <h2 id="osce-quiz-title" class="font-bold"></h2>
                             <div class="flex gap-2"><div id="osce-score"></div><div id="osce-timer">00:00</div></div>
                         </div>
                         <div class="flex-1 grid grid-cols-1 md:grid-cols-2 gap-4 p-4 overflow-y-auto">
                             <div class="bg-slate-50 p-4 rounded">
                                 <h3 id="osce-case-title" class="font-bold">Case Title</h3>
                                 <div id="osce-case-image-container"></div>
                                 <p id="osce-case-description" class="text-sm mt-2"></p>
                             </div>
                             <div>
                                 <p id="osce-progress-text"></p>
                                 <div id="osce-question-image-container"></div>
                                 <h3 id="osce-question-text" class="font-bold mb-4">Question...</h3>
                                 <div id="osce-answer-area"></div>
                                 <div id="osce-model-answer-area" class="hidden"></div>
                                 <div id="osce-self-correction-area" class="hidden"></div>
                                 <div id="osce-controls-container" class="flex justify-between mt-4">
                                     <button id="osce-previous-btn" class="bg-gray-300 px-4 py-2 rounded">Prev</button>
                                     <button id="osce-navigator-btn"><i class="fas fa-list"></i></button>
                                     <button id="osce-next-btn" class="bg-blue-600 text-white px-4 py-2 rounded">Next</button>
                                 </div>
                             </div>
                         </div>
                    </div>
                 </div>

                 <div id="study-planner-container" class="w-full hidden pb-20">
                     <div class="p-4 border-b bg-white dark:bg-slate-800 flex justify-between">
                        <button id="study-planner-back-btn"><i class="fas fa-arrow-left"></i></button>
                        <h2 class="font-bold">Planner</h2>
                        <button id="show-create-plan-modal-btn"><i class="fas fa-plus"></i></button>
                     </div>
                     <div class="p-4">
                         <div id="study-planner-loader" class="loader hidden"></div>
                         <details id="performance-insights-container" class="hidden mb-4 bg-white p-2 rounded"><summary>Insights</summary><ul id="strengths-list"></ul><ul id="weaknesses-list"></ul></details>
                         <div id="planner-dashboard">
                             <div id="study-plans-list" class="space-y-3"></div>
                         </div>
                         <div id="active-plan-view" class="hidden">
                             <button id="back-to-plans-dashboard-btn" class="text-xs text-blue-500 mb-2">Back</button>
                             <h3 id="active-plan-name" class="text-xl font-bold mb-4">My Plan</h3>
                             <div id="study-plan-summary" class="mb-4"><p id="plan-days-remaining"></p><p id="plan-tasks-today"></p><div id="plan-progress-bar"></div></div>
                             <div id="study-plan-days-container" class="space-y-3"></div>
                         </div>
                     </div>
                 </div>

                 <div id="learning-mode-container" class="w-full hidden pb-20">
                     <div class="p-4 border-b bg-white dark:bg-slate-800 flex justify-between">
                         <button id="learning-mode-back-btn"><i class="fas fa-arrow-left"></i></button>
                         <h2 id="learning-title" class="font-bold">Learning</h2>
                         <div></div>
                     </div>
                     <div id="learning-mode-controls" class="p-6 max-w-xl mx-auto space-y-4">
                         <input type="text" id="learning-search-input" class="w-full p-3 border rounded" placeholder="Search Topic...">
                         <button id="learning-search-btn" class="w-full bg-blue-600 text-white py-3 rounded font-bold">Search</button>
                         <p id="learning-search-error" class="hidden text-red-500"></p>
                         <button id="learning-browse-by-chapter-btn" class="w-full bg-slate-100 text-slate-800 py-3 rounded font-bold">Browse Chapters</button>
                         <button id="learning-browse-by-source-btn" class="w-full bg-slate-100 text-slate-800 py-3 rounded font-bold">Browse Sources</button>
                         <button id="learning-mistakes-btn" class="w-full bg-orange-500 text-white py-3 rounded font-bold">Study Mistakes</button>
                         <button id="learning-bookmarked-btn" class="w-full bg-sky-500 text-white py-3 rounded font-bold">Study Bookmarked</button>
                     </div>
                     <div id="learning-mode-viewer" class="hidden h-full flex flex-col p-4">
                         <div class="flex justify-end"><button id="end-learning-btn" class="text-red-500">Exit</button></div>
                         <div class="flex-1 overflow-y-auto">
                             <p id="learning-progress-text" class="text-center text-gray-500">Loading...</p>
                             <p id="learning-source-text" class="text-center text-gray-400 text-xs"></p>
                             <div id="learning-image-container" class="flex justify-center"></div>
                             <h2 id="learning-question-text" class="text-lg font-bold mb-4">Question...</h2>
                             <div id="learning-answer-buttons" class="space-y-3"></div>
                         </div>
                         <div class="flex justify-between pt-4 border-t">
                             <button id="learning-previous-btn" class="bg-gray-300 px-4 py-2 rounded">Prev</button>
                             <button id="learning-next-btn" class="bg-blue-600 text-white px-6 py-2 rounded">Next</button>
                         </div>
                     </div>
                 </div>

                 <div id="theory-container" class="w-full hidden pb-20">
                    <div id="theory-controls" class="p-4">
                         <div class="flex justify-between mb-4"><button id="theory-back-btn">Back</button> <h2>Theory</h2></div>
                         <input id="theory-search-input" class="border p-2 w-full mb-2"> <button id="theory-search-btn" class="bg-yellow-500 text-white p-2 w-full mb-2">Search</button>
                         <button id="theory-flashcard-mode-btn" class="bg-orange-500 text-white p-2 w-full mb-2">Flashcard</button>
                         <button id="theory-exam-mode-btn" class="bg-red-500 text-white p-2 w-full mb-2">Exam Mode</button>
                         <button id="theory-browse-by-chapter-btn" class="bg-gray-200 p-2 w-full mb-2">Chapters</button>
                         <button id="theory-browse-by-source-btn" class="bg-gray-200 p-2 w-full mb-2">Sources</button>
                    </div>
                    <div id="theory-viewer" class="hidden p-4">
                         <div class="flex justify-between"><button id="theory-end-btn">End</button> <h2 id="theory-title"></h2> <div id="theory-timer"></div></div>
                         <p id="theory-progress-text"></p>
                         <p id="theory-source-text"></p>
                         <div id="theory-img-container"></div>
                         <h3 id="theory-question-text" class="font-bold text-xl mb-4"></h3>
                         <button id="theory-show-answer-btn" class="bg-blue-600 text-white p-2 rounded w-full mb-4">Show Answer</button>
                         <div id="theory-answer-container" class="hidden bg-green-50 p-4 border-l-4 border-green-500"> <p id="theory-answer-text"></p> </div>
                         <div class="flex justify-between mt-4">
                             <button id="theory-prev-btn" class="bg-gray-300 p-2 rounded">Prev</button>
                             <div class="flex gap-2">
                                <button id="theory-note-btn"><i class="fas fa-sticky-note"></i></button>
                                <button id="theory-status-btn"><i class="fas fa-check"></i></button>
                             </div>
                             <button id="theory-next-btn" class="bg-blue-600 text-white p-2 rounded">Next</button>
                         </div>
                    </div>
                 </div>

                 <div id="activity-log-container" class="w-full hidden pb-20">
                     <div class="p-4 border-b flex justify-between">
                         <button id="activity-back-btn"><i class="fas fa-arrow-left"></i></button>
                         <h2>Activity</h2>
                         <button id="clear-log-btn" class="text-red-500 text-xs">Clear</button>
                     </div>
                     <div class="p-4">
                         <div id="all-summary" class="hidden">
                            <p id="all-lectures-progress"></p><p id="all-questions-progress"></p>
                         </div>
                         <div id="quiz-summary" class="hidden">
                            <p id="total-correct-answers"></p><p id="total-incorrect-answers"></p><p id="overall-accuracy"></p>
                         </div>
                         <div id="lecture-summary" class="hidden">
                             <p id="lectures-viewed-count"></p><p id="chapters-started-count"></p>
                         </div>
                         <button id="log-filter-all" class="hidden"></button><button id="log-filter-quizzes" class="hidden"></button><button id="log-filter-lectures" class="hidden"></button>
                         <canvas id="activity-chart" class="mb-4"></canvas>
                         <div id="activity-log-list" class="space-y-2"></div>
                     </div>
                 </div>

                 <div id="notes-container" class="w-full hidden pb-20">
                     <div class="p-4 border-b flex justify-between">
                         <button id="notes-back-btn"><i class="fas fa-arrow-left"></i></button>
                         <h2>Notes</h2>
                         <div></div>
                     </div>
                     <div class="p-4" id="notes-list"></div>
                     <button id="notes-filter-quizzes" class="hidden"></button>
                     <button id="notes-filter-lectures" class="hidden"></button>
                     <button id="notes-filter-theory" class="hidden"></button>
                 </div>

                 <div id="library-container" class="w-full hidden pb-20">
                      <div class="p-4 border-b flex justify-between">
                         <button id="library-back-btn"><i class="fas fa-arrow-left"></i></button>
                         <h2>Library</h2>
                         <div></div>
                     </div>
                     <div id="library-loader" class="loader hidden"></div>
                     <div id="library-list" class="p-4 grid grid-cols-2 gap-4"></div>
                 </div>

                 <div id="leaderboard-container" class="w-full hidden pb-20">
                      <div class="p-4 border-b flex justify-between">
                         <button id="leaderboard-back-btn"><i class="fas fa-arrow-left"></i></button>
                         <h2>Leaderboard</h2>
                         <div></div>
                     </div>
                     <div class="p-4">
                         <div id="leaderboard-loader" class="loader hidden"></div>
                         <div id="current-user-rank" class="mb-4 p-3 bg-blue-50 rounded border border-blue-100"></div>
                         <div id="leaderboard-list" class="space-y-2"></div>
                     </div>
                 </div>

                 <div id="list-container" class="w-full hidden pb-20">
                     <div class="p-4 border-b flex justify-between">
                         <button id="list-back-btn"><i class="fas fa-arrow-left"></i></button>
                         <h2 id="list-title">List</h2>
                         <div></div>
                     </div>
                     <div id="list-items" class="p-4 grid grid-cols-1 gap-2"></div>
                 </div>

            </main>

            <nav id="mobile-bottom-nav" class="md:hidden fixed bottom-0 w-full bg-white dark:bg-slate-900 border-t dark:border-slate-700 shadow-lg z-40 flex justify-around items-center pb-safe pt-2 h-16">
                <button id="nav-home-btn" class="nav-item active flex flex-col items-center justify-center w-full h-full text-blue-600">
                    <i class="fas fa-home text-xl mb-1"></i>
                    <span class="text-[10px] font-medium">Home</span>
                </button>
                <button id="nav-lectures-btn" class="nav-item flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
                    <i class="fas fa-video text-xl mb-1"></i>
                    <span class="text-[10px] font-medium">Lectures</span>
                </button>
                <button id="nav-qbank-btn" class="nav-item flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
                    <div class="w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center shadow-lg transform -translate-y-4 border-4 border-white dark:border-slate-900">
                        <i class="fas fa-plus text-lg"></i>
                    </div>
                </button>
                <button id="nav-planner-btn" class="nav-item flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
                    <i class="fas fa-calendar-alt text-xl mb-1"></i>
                    <span class="text-[10px] font-medium">Planner</span>
                </button>
                <button id="nav-menu-btn" class="nav-item flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
                    <i class="fas fa-bars text-xl mb-1"></i>
                    <span class="text-[10px] font-medium">More</span>
                </button>
            </nav>

            <div id="mobile-menu-drawer" class="fixed inset-0 bg-black/50 z-50 hidden flex justify-end">
                 <div class="w-64 bg-white dark:bg-slate-900 h-full shadow-2xl flex flex-col p-4 animate-slideLeft">
                     <div class="flex justify-between items-center mb-6 border-b pb-4 dark:border-slate-700">
                         <h2 class="font-bold text-lg dark:text-white">Menu</h2>
                         <button id="close-menu-btn" class="text-slate-500 text-2xl">&times;</button>
                     </div>
                     <div class="space-y-4 flex-1 overflow-y-auto">
                         <button id="drawer-learning-btn" class="w-full text-left p-2 rounded hover:bg-slate-100 dark:text-slate-300"><i class="fas fa-book-reader mr-3 w-6"></i> Learning Mode</button>
                         <button id="drawer-matching-btn" class="w-full text-left p-2 rounded hover:bg-slate-100 dark:text-slate-300"><i class="fas fa-puzzle-piece mr-3 w-6"></i> Matching</button>
                         <button id="drawer-osce-btn" class="w-full text-left p-2 rounded hover:bg-slate-100 dark:text-slate-300"><i class="fas fa-user-md mr-3 w-6"></i> OSCE</button>
                         <button id="drawer-library-btn" class="w-full text-left p-2 rounded hover:bg-slate-100 dark:text-slate-300"><i class="fas fa-book-bookmark mr-3 w-6"></i> Library</button>
                         <button id="drawer-notes-btn" class="w-full text-left p-2 rounded hover:bg-slate-100 dark:text-slate-300"><i class="fas fa-sticky-note mr-3 w-6"></i> My Notes</button>
                         <button id="drawer-activity-btn" class="w-full text-left p-2 rounded hover:bg-slate-100 dark:text-slate-300"><i class="fas fa-history mr-3 w-6"></i> Activity Log</button>
                         <button id="drawer-leaderboard-btn" class="w-full text-left p-2 rounded hover:bg-slate-100 dark:text-slate-300"><i class="fas fa-trophy mr-3 w-6"></i> Leaderboard</button>
                         <button id="drawer-radio-btn" class="w-full text-left p-2 rounded hover:bg-slate-100 dark:text-slate-300"><i class="fas fa-broadcast-tower mr-3 w-6"></i> Radio</button>
                     </div>
                     <div class="border-t pt-4 dark:border-slate-700">
                         <button id="logout-btn" class="w-full text-left p-2 text-red-500 font-bold"><i class="fas fa-sign-out-alt mr-3 w-6"></i> Log Out</button>
                     </div>
                 </div>
            </div>
        </div>
    </div>

    <div id="modal-backdrop" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-[100]">
        
        <div id="user-card-modal" class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-2xl max-w-md w-full hidden relative">
            <button id="user-card-close-btn" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">&times;</button>
            <div class="text-center">
                <img id="user-avatar" src="" class="w-24 h-24 rounded-full mx-auto border-4 border-blue-500 mb-3 shadow-lg">
                <h3 id="card-user-name" class="text-xl font-bold text-slate-800 dark:text-white">Dr. Name</h3>
                <p id="card-user-nickname" class="text-slate-500 italic">The Surgeon</p>
            </div>
            <div id="profile-details-view" class="mt-6 space-y-3 bg-slate-50 dark:bg-slate-700/50 p-4 rounded-xl">
                <div class="flex justify-between"><span class="text-slate-500">Exam Date</span> <span id="card-exam-date" class="font-bold dark:text-white">--</span></div>
                <div class="flex justify-between"><span class="text-slate-500">Score</span> <span id="card-quiz-score" class="font-bold text-blue-600">0</span></div>
                <div class="flex justify-between"><span class="text-slate-500">Subscription</span> <span id="card-subscription-expiry" class="font-bold text-green-600">Active</span></div>
            </div>
            <button id="edit-profile-btn" class="w-full mt-4 border border-blue-500 text-blue-500 py-2 rounded-lg hover:bg-blue-50">Edit Profile</button>
            <div id="profile-edit-view" class="hidden mt-4">
                <input id="edit-nickname" class="w-full border p-2 mb-2 rounded" placeholder="Nickname">
                <input type="date" id="edit-exam-date" class="w-full border p-2 mb-2 rounded">
                <div id="avatar-selection-grid" class="grid grid-cols-5 gap-2 mb-4"></div>
                <div class="flex gap-2">
                    <button id="save-profile-btn" class="flex-1 bg-blue-600 text-white py-2 rounded">Save</button> 
                    <button id="cancel-edit-profile-btn" class="flex-1 bg-gray-300 py-2 rounded">Cancel</button>
                </div>
            </div>
        </div>

        <div id="messenger-modal" class="bg-white dark:bg-slate-800 rounded-xl p-4 w-full max-w-md h-[500px] flex flex-col hidden relative">
            <div class="flex justify-between items-center border-b pb-2 mb-2">
                <h3 class="font-bold dark:text-white">Messenger</h3>
                <button id="messenger-close-btn">&times;</button>
            </div>
            <div id="messages-list" class="flex-1 overflow-y-auto p-2 space-y-2 bg-slate-50 dark:bg-slate-900 rounded"></div>
            <div class="mt-2 flex gap-2">
                <input id="message-input" class="flex-1 border rounded p-2 dark:bg-slate-700 dark:text-white" placeholder="Ask admin...">
                <button id="send-message-btn" class="bg-blue-600 text-white px-4 rounded"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>

        <div id="onboarding-modal" class="bg-white p-6 rounded-lg hidden max-w-sm"> 
            <button id="start-tour-btn" class="bg-blue-600 text-white px-4 py-2 rounded">Start</button> 
            <button id="skip-tour-btn" class="ml-2 text-gray-500">Skip</button> 
        </div>
        <div id="registration-modal" class="bg-white p-6 rounded-lg hidden max-w-md"> 
            <form id="registration-form">
                <input id="register-name" class="w-full border p-2 mb-2" placeholder="Name" required>
                <input id="register-username" class="w-full border p-2 mb-2" placeholder="Username" required>
                <input id="register-email" class="w-full border p-2 mb-2" placeholder="Email" required>
                <input id="register-mobile" class="w-full border p-2 mb-2" placeholder="Mobile" required>
                <input id="register-password" type="password" class="w-full border p-2 mb-2" placeholder="Password" required>
                <input id="register-confirm-password" type="password" class="w-full border p-2 mb-2" placeholder="Confirm Password" required>
                <input id="register-country" class="w-full border p-2 mb-2" placeholder="Country" required>
                <input id="register-study-type" class="w-full border p-2 mb-2" placeholder="Study Type">
                <input type="date" id="register-exam-date" class="w-full border p-2 mb-2">
                <button type="submit" id="register-submit-btn" class="bg-green-600 text-white px-4 py-2 rounded w-full">Register</button>
                <button type="button" id="register-cancel-btn" class="mt-2 text-gray-500 w-full">Cancel</button>
                <p id="registration-error" class="text-red-500 hidden"></p>
            </form> 
        </div>
        <div id="create-plan-modal" class="bg-white p-6 rounded-lg hidden max-w-sm">
             <input id="new-plan-name" class="w-full border p-2 mb-2" placeholder="Plan Name">
             <input type="date" id="new-plan-start-date" class="w-full border p-2 mb-2">
             <input type="date" id="new-plan-end-date" class="w-full border p-2 mb-2">
             <button id="confirm-create-plan-btn" class="bg-blue-600 text-white px-4 py-2 rounded">Create</button>
             <button id="cancel-create-plan-btn" class="ml-2 text-gray-500">Cancel</button>
             <p id="create-plan-error" class="text-red-500 hidden"></p>
        </div>
        <div id="confirmation-modal" class="bg-white p-6 rounded-lg hidden"> <h3 id="modal-title"></h3> <p id="modal-text"></p> <button id="modal-confirm-btn">Yes</button> <button id="modal-cancel-btn">No</button> </div>
        <div id="clear-log-modal" class="bg-white p-6 rounded-lg hidden"> <button id="clear-quiz-logs-btn">Quiz Logs</button> <button id="clear-lecture-logs-btn">Lecture Logs</button> <button id="clear-all-logs-btn">All</button> <button id="clear-log-cancel-btn">Cancel</button> </div>
        <div id="announcements-modal" class="bg-white p-6 rounded-lg hidden"> <div id="announcements-list"></div> <button id="announcements-close-btn">Close</button> </div>
        <div id="question-navigator-modal" class="bg-white p-6 rounded-lg hidden"> <div id="navigator-grid"></div> <button id="navigator-close-btn">Close</button> </div>
        <div id="osce-navigator-modal" class="bg-white p-6 rounded-lg hidden"> <div id="osce-navigator-content"></div> <button id="osce-navigator-close-btn">Close</button> </div>
        <div id="ios-install-modal" class="bg-white p-6 rounded-lg hidden relative"> <button id="ios-install-close-btn" class="absolute top-2 right-2">&times;</button> Install on iOS instructions... </div>
        <div id="note-modal" class="bg-white rounded-lg p-6 shadow-xl max-w-lg w-full hidden"> <h3 id="note-modal-title"></h3> <textarea id="note-textarea"></textarea> <button id="note-save-btn">Save</button> <button id="note-cancel-btn">Cancel</button> </div>
        <div id="tour-tooltip" class="bg-white p-4 shadow-lg rounded absolute hidden z-[200] w-64"> <h3 id="tour-title" class="font-bold"></h3> <p id="tour-text"></p> <button id="tour-next-btn" class="bg-blue-600 text-white px-2 py-1 rounded text-xs">Next</button> <button id="tour-end-btn" class="text-gray-500 text-xs">End</button> <span id="tour-step-count"></span> </div>
    </div>

    <div id="image-viewer-modal" class="hidden fixed inset-0 bg-black z-[200] flex items-center justify-center">
        <button id="image-viewer-close-btn" class="absolute top-4 right-4 text-white text-4xl">&times;</button>
        <img id="modal-image" class="max-h-screen max-w-full object-contain">
    </div>

    <div id="radio-banner-container" class="hidden"> <iframe src=""></iframe> <button id="radio-close-btn"></button> </div>

    <script>
        // Sidebar & Navigation Mapping Logic
        document.getElementById('nav-menu-btn').addEventListener('click', () => document.getElementById('mobile-menu-drawer').classList.remove('hidden'));
        document.getElementById('close-menu-btn').addEventListener('click', () => document.getElementById('mobile-menu-drawer').classList.add('hidden'));
        document.getElementById('mobile-menu-drawer').addEventListener('click', (e) => { if(e.target === document.getElementById('mobile-menu-drawer')) document.getElementById('mobile-menu-drawer').classList.add('hidden'); });
        
        const mapSidebarToMain = {
            'sidebar-lectures-btn': 'lectures-btn', 'sidebar-qbank-btn': 'qbank-btn', 'sidebar-planner-btn': 'study-planner-btn',
            'sidebar-learning-btn': 'learning-mode-btn', 'sidebar-matching-btn': 'matching-btn', 'sidebar-osce-btn': 'osce-btn',
            'sidebar-theory-btn': 'theory-btn', 'sidebar-library-btn': 'library-btn', 'sidebar-notes-btn': 'notes-btn',
            'sidebar-activity-btn': 'activity-log-btn', 'sidebar-radio-btn': 'radio-btn', 'sidebar-profile-btn': 'user-profile-header-btn',
            'mobile-profile-btn': 'user-profile-header-btn', 'nav-home-btn': 'global-home-btn', 'sidebar-home-btn': 'global-home-btn',
            'nav-lectures-btn': 'lectures-btn', 'nav-qbank-btn': 'qbank-btn', 'nav-planner-btn': 'study-planner-btn',
            'drawer-learning-btn': 'learning-mode-btn', 'drawer-matching-btn': 'matching-btn', 'drawer-osce-btn': 'osce-btn',
            'drawer-library-btn': 'library-btn', 'drawer-notes-btn': 'notes-btn', 'drawer-activity-btn': 'activity-log-btn',
            'drawer-leaderboard-btn': 'leaderboard-btn', 'drawer-radio-btn': 'radio-btn'
        };

        Object.keys(mapSidebarToMain).forEach(sidebarId => {
            const sidebarEl = document.getElementById(sidebarId);
            if(sidebarEl) {
                sidebarEl.addEventListener('click', () => {
                    const targetId = mapSidebarToMain[sidebarId];
                    if (targetId === 'global-home-btn') {
                        document.querySelectorAll('[id$="-container"]').forEach(el => { if(el.id !== 'main-menu-container' && el.id !== 'login-container') el.classList.add('hidden'); });
                        document.getElementById('main-menu-container').classList.remove('hidden');
                        document.getElementById('global-header').classList.remove('hidden');
                        document.getElementById('mobile-menu-drawer').classList.add('hidden');
                        // Reset Nav Active State
                        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                        document.getElementById('nav-home-btn').classList.add('active');
                    } else {
                        const targetEl = document.getElementById(targetId);
                        if(targetEl) targetEl.click();
                    }
                });
            }
        });

        if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); }); }
    </script>

    <script type="module" src="js/main.js"></script>
    <script src="js/login-animation.js"></script>
</body>
</html>

